# Single Threaded Execution
- 이 다리를 건널 수 있는 사람은 오직 한명

## Single Threaded Execution 패턴이란
- 멀티 쓰레드의 기초가 되는 패턴으로 '한번에 한개의 쓰레드만 처리를 실행할 수 있다'는 뜻을 가진다.
- 통나무로 예를 들면, 통나무만 있는 다리에 사람이 동시에 2명이 올라가게 되면 무게를 버티지 못하고 무너진다. 즉, 통나무를 건너려면 한번에 한사람만 건널 수 있다는 의미이다.
- Single Threaded Execution에서 이 통나무 다리영역(비지니스 로직 함수)은 Critical Section or Critical Region이라고 불리고 지나가는 사람(실행 함수)을 Thread라고 보면 된다.

## 예제 설명 - 코드는 trainging project
- 한번에 한명(Thread)만 통과할 수 있는 GATE(Functuion)가 존재하는데, 이 GATE를 지날때 방문록을 써야한다.
- 방문록은 index, 이름, 출신지순으로 출력합니다.
- check 메소드를 통해 맨 마지막에 통과한 사람의 기록이 올바른지 조사합니다.(이름와 출신지가 같아야함.)
- 만약 check 메소드를 통해 맨 마지막에 통과한 사람의 기록이 올바르지 않다면 '***** BROKEN *****' 을 출력합니다.
- Thread는 생성자로 필드들을 초기화하며 해당 필드들은 final로 변수들을 지정하여 set() 함수로 인한 실수를 방지합니다.(final 선언시 변수값 변경 불가능)
- 실행 결과
    - 실패
        - 실제로 실행을 해보면 check 메소드를 통한 기록이 올바르지 않는 메세지가 많이 출력됩니다. 또한 index수도 기하급수적으로 늘어납니다.
        - 여기서 check 메소드에서 일부러 올바르지 않는 메세지를 출력하기 위해 무한루프로 돌렸습니다.(몇십, 몇백으로는 검출이 안될수도 있다.)
        - 멀티쓰레드 프로그래밍이 어려운 것중 하나가 바로 이 부분입니다. 체크에서 에러가 검출되면 안전하지만 아무것도 검출되지 않다고 해서 안전을 장담할 수 없기 때문입니다.
        - 이러한 경우가 발생하는 이유는 보통 쓰레드는 다른 쓰레드를 고려하지 않고 동작하기 때문입니다. 즉, 쓰레드가 다른 쓰레드를 고려하지 않기 때문에 서로 공유하고 있는 인스턴스 필드를 수정했기 때문입니다. A가 수정하는 도중에 B도 접근하여 수정되거나 A와 B가 한번에 접근하여 데이터 Race가 일어나는 경우일수도 있습니다.
    - 성공
        - Gate 클래스 내에 pass함수와 toString()함수에 synchronized를 추가하였습니다.
        - synchronized 메소드는 동시에 한개의 쓰레드에서만 실행되는 것을 보증합니다. 즉 실패의 동작처럼 하나의 쓰레드가 함수에 접근하게 되면 다른 쓰레드의 접근을 통제하여 동시가 아닌 하나의 작업만 일어나게 되는 것입니다.

## 정리
- ShreadResource(공유자원) 역할
    - Single Thread Execution 패턴에서는 SharedResource역할을 하는 클래스가 등장하는데 이는 Gate 클래스가 담당했습니다.
    - 해당 SharedResource 역할하는 클래스는 보통 1개 이상의 쓰레드가 Access하게 되며 2가지 분류의 메소드를 가지게 됩니다.
        - Thread safeMethod : 복수의 쓰레드가 동시에 호출해도 아무런 문제가 발생하지 않는다.(동시성, 쓰레드 레이스등와 같은 문제가 발생하지 않는다)
        - Thread unsafeMetohd : 복수의 쓰레드에서 동시에 호출하게 되면 문제가 발생하기에 처리가 필요한 메소드
    - Java에서는 Thread unsafeMethod에 synchronized함으로써 가드합니다.
    

