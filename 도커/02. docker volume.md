# docker volume

## docker volume
- docker volume이란? 각 컨테이너를 생성하게 되면 이미지는 변경되지 않고 컨테이너 계층에서 변경된 파일시스템을 저장합니다. 여기에 단점이 존재하는데 컨테이너를 삭제하면 해당 데이터 또한 삭제되며 컨테이너는 생성과 삭제가 쉬워 실수로 삭제하게 되면 데이터를 복구할 수 없게 됩니다. 이를 방지하기 위해 컨테이너에서는 영속적 데이터를 활용하는 몇가지 방법이 존재하는 그 중 하나가 바로 docker volume입니다. docker volume은 호스트 특정 위치에 마운트시키는 것으로, 호스트와 볼륨을 공유할 수도 있고, 볼륨 컨테이너를 생성하는 방법도 있는 등이 있습니다.

## 호스트 볼륨 공유
- 컨테이너를 생성할떄 호스트와 컨테이너폴더 사이에 마운트지점을 지정하는 방법입니다.
- 명령어
    - [-v [호스트 주소]:[컨테이너 주소]] : 호스트 주소와 컨테이너 주소를 마운트 하는 명령어(조심해야될 점, 호스트 주소에 파일이 있으면 컨테이너 주소에 덮어쓰기 된다.)
- 컨테이너를 생성할때 명령어를 통해 생성이후 해당 컨테이너를 지워도 호스트에서 마운트된 폴더에는 해당 데이터들이 그대로 남아 있습니다.
- 또한 이런 부분들을 동기화라고 생각할수 있는데 그게 아니라 완전히 같은 디렉토리라고 생각하시면 됩니다.

## 볼륨 컨테이너 
- 볼륨 -v 옵션을 사용하여 만든 컨테이너를 다른 컨테이너에 공유를 할수 있습니다. 그러나 이는 직접이 아닌 -v옵션을 적용한 컨테이너 한에서 가능합니다.
- 명령어
    - [--volumes-from [-v 옵션이 적용된 컨테이너]] : 호스트 볼륨을 직접 접근이 아닌 적용된 컨테이너의 폴더를 통해서 공유함으로 간접적으로 공유한다고 볼수 있습니다.
- 즉, 볼륨이 적용된 컨테이너 폴더를 다른 컨테이너에 해당 폴더를 공유함으로써 간접적으로 호스트 폴더와 한다리 걸쳐서 공유된다고 보면 됩니다.

## 도커 볼륨
- 도커 자체에서 제공되는 볼륨 기능
- 명령어
    - [docker volume create --name [이름]]
    - [docker volume ls] : 생성된 도커 볼륨 확인
- 볼륨을 생성하고 -v 옵션을 통해서 호스트 주소 대신 볼륨이름을 넣으면 됩니다.
    - -v [volume이름]:[컨테이너 주소]
- 다른 컨테이너에도 공유가 가능합니다.
- 도커 볼륨은 도커에서 기능을 제공함으로 데이터는 실제로 보존 및 존재하지만 실제로 어디에 저장되는지는 사용자는 알필요가 없습니다.
- 실제로 어디에 저장되는지 확인하려면 [insepct] 명령어를 사용하면 되는데..
    - 명령어
        - [docker inspect --type volume [volume이름]]
- 실제로 해당 디렉토리의 파일을 확인해보면 사용했던 파일이 남아있습니다. 
- docker volume을 생성하고 삭제하다보면 사용하지 않는 볼륨들이 남아 있게 됩니다.(자동으로 삭제가 되지 않음) 이를 명령어를 통해 한번에 다 삭제할수 있습니다.
    - 명령어
        - [docker volume prune] : 안쓰이는 도커 볼륨 전체 삭제

## 도커 컨테이너 볼륨 설계
- 도커 컨테이너에 저장하는게 아닌 외부에 저장하고 컨테이너는 그 데이터로 동작하게 설계하는 방식은 스테이트리스(stateless)라고 합니다. 즉, 컨테이너 자체는 데이터를 가지고 있지 않고 외부로부터 데이터를 공급 받습니다.(컨테이너는 상태가 없음, 외부에서 지정해주기 때문에)
- 이는 컨테이너가 삭제되어도 외부에 데이터가 존재하기 때문에 바람직한 설계입니다.
- 반대로 컨테이너가 저장하고 있는 경우는 스테이트풀(stateful)라고 하며 이러한 설계는 지양하는 것이 좋습니다.

